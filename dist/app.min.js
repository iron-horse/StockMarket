"use strict";function config($locationProvider,$routeProvider){$locationProvider.hashPrefix("!"),$routeProvider.when("/",{templateUrl:"views/market.html",controller:"marketController"}).when("/management",{templateUrl:"views/management.html",controller:"managementController"}).when("/investor",{templateUrl:"views/investor.html",controller:"investorController"}).otherwise({redirectTo:"/"})}angular.module("app.components",[]),angular.module("app",["ngRoute","app.routes","app.services","app.components","app.investor","app.management","app.market"]),angular.module("app.routes",["ngRoute"]).config(config),angular.module("app.services",[]),function(){function show(StockService){function stockDetailsController($scope){var self=$scope;self.refresh=function(sym){StockService.getStock(sym).success(function(stock){self.stock=stock,self.stock.tradeHistory.timestamps=self.stock.tradeHistory.timestamps.map(function(timestamp){return new Date(timestamp)})}).error(function(data,status){console.error("Repos error",status,data)})},self.refresh(self.stock.symbol)}return{controller:stockDetailsController,templateUrl:"views/stockDetails.html",restrict:"E",scope:{stock:"=",quantity:"="}}}angular.module("app.components").directive("stockDetails",show)}(),function(){function showGraph(StockService,$window){function stockGraphController(scope,element){scope.chart=c3.generate({bindto:$window.d3.select(element[0]),size:{height:240,width:1e3},data:{x:"timestamp",xFormat:"%Y-%m-%d %H:%M:%S",columns:[["price"].concat(scope.prices),["timestamp"].concat(scope.timestamps)]},axis:{x:{type:"timeseries",tick:{fit:!0,format:"%Y-%m-%d %H:%M:%S"}}}}),scope.chart.zoom.enable(!0),scope.$watch("timestamps",function(){scope.chart.load({columns:[["price"].concat(scope.prices.slice(-25)),["timestamp"].concat(scope.timestamps.slice(-25))]})})}return{link:stockGraphController,scope:{prices:"=",timestamps:"="}}}angular.module("app.components").directive("stockGraph",showGraph)}(),angular.module("app.investor",["ngRoute"]).controller("investorController",["$scope","$http","StockService","InvestorService",function($scope,$http,StockService,InvestorService){var self=$scope;self.myInvestor={},self.stocks={},self.refresh=function(){InvestorService.getActiveInvestors().success(function(investor){self.myInvestor=investor,self.stocks=investor.stocks}).error(function(data,status){console.error("Repos error",status,data)})},self.refresh(),self.deselect=function(){self.stock=null},self.buy=function(stock){StockService.buyStock(stock.symbol,stock.quantity).success(function(response){self.deselect(),self.refresh(),self.message=response,self.messageColor="success"}).error(function(data,status){self.message=data,self.messageColor="warning",console.error("Repos error",status,data)})},self.sell=function(stock){StockService.sellStock(stock.symbol,stock.quantity).success(function(response){self.deselect(),self.refresh(),console.log(response),self.message=response,self.messageColor="success"}).error(function(data,status){self.message=data,self.messageColor="warning",console.error("Repos error",status,data)})}}]),angular.module("app.management",["ngRoute"]).controller("managementController",["$scope","$http","InvestorService","StockService","MarketService",function($scope,$http,InvestorService,StockService,MarketService){var self=$scope,refreshInvestor=function(){InvestorService.getAllInvestors().success(function(investors){self.investors=investors}).error(function(data){self.message=data,self.messageColor="warning"})},refreshStock=function(){StockService.getAllStocks().success(function(stocks){self.stocks=stocks}).error(function(data){self.message=data,self.messageColor="warning"})};self.investors={},self.stocks={},self.marketAction=function(action){MarketService.takeAction(action).success(function(response){self.message=response,self.messageColor="success"}).error(function(data){self.message=data,self.messageColor="warning"})},self.deselectStock=function(){self.edit=!1,self.stock=null},refreshInvestor(),refreshStock(),self.addInvestor=function(investor){InvestorService.addInvestor(investor).success(function(response){self.investor=null,self.investors.push(response),self.message="Investor added successfully.",self.messageColor="success"}).error(function(data){self.message=data,self.messageColor="warning"})},self.makeActive=function(investor){InvestorService.makeInvestorActive(investor).success(function(response){self.message=response,self.messageColor="success"}).error(function(data){self.message=data,self.messageColor="warning"})},self.addStock=function(stock){StockService.add(stock).success(function(response){self.stocks.push(response),self.deselectStock(),self.message="Stock added successfully.",self.messageColor="success"}).error(function(data){self.message=data,self.messageColor="warning"})},self.updateStock=function(stock){StockService.update(stock).success(function(response){self.deselectStock(),self.message=response,self.messageColor="success"}).error(function(data){self.message=data,self.messageColor="warning"})},self.editStock=function(stock){self.edit=!0,self.stock=stock}}]),angular.module("app.market",["ngRoute"]).controller("marketController",["$scope","$http","StockService",function($scope,$http,StockService){var self=$scope;self.stocks={},StockService.getAllStocks().success(function(stocks){self.stocks=stocks})}]),angular.module("app.services").factory("InvestorService",function($http){return{getActiveInvestors:function(){return $http.get("/active-investor")},getAllInvestors:function(){return $http.get("/investors")},addInvestor:function(investor){return $http.post("/investors",investor,{headers:{"Content-Type":"application/json"}})},getInvestorInfo:function(investor){return $http.get("/investors/"+investor.name)},makeInvestorActive:function(investor){return $http({method:"PATCH",url:"/investors/"+investor.name+"/active",headers:{"Content-Type":"application/json"}})}}}),angular.module("app.services").factory("MarketService",function($http){return{takeAction:function(action){return $http({method:"PATCH",url:"/market/"+action,headers:{"Content-Type":"application/json"}})}}}),angular.module("app.services").factory("StockService",function($http){return{getAllStocks:function(){return $http.get("/stocks")},getStock:function(stockSymbol){return $http.get("/stocks/"+stockSymbol)},add:function(stock){return $http({method:"POST",url:"/stocks",headers:{"Content-Type":"application/json"},data:stock})},update:function(stock){return $http({method:"PUT",url:"/stocks/"+stock.symbol,headers:{"Content-Type":"application/json"},data:stock})},buyStock:function(stockSymbol,quantity){return $http({method:"PATCH",url:"/stocks/buy/"+stockSymbol,headers:{"Content-Type":"application/json"},data:{quantity:quantity}})},sellStock:function(stockSymbol,quantity){return $http({method:"PATCH",url:"/stocks/sell/"+stockSymbol,headers:{"Content-Type":"application/json"},data:{quantity:quantity}})}}});